# LAW 5 AUDIT: File & Artifact Hygiene

> **Date:** 2025-12-11T20:30:00Z  
> **Auditor:** Claude/Copilot Agent  
> **Purpose:** Identify violations of LAW 5 (Single Source of Truth, No Duplication)  
> **Revised:** After reading docs/README.md, debug/README.md, archive/README.md, installation-neural-register.md

---

## Executive Summary

| Category | Count | Action per Documentation Standards |
|----------|-------|-----------------------------------|
| **Install Escape Scripts** | 6 files | Add Issue #5 to installation-compendium.md, archive scripts |
| **New Feature (elefante_mode)** | 4 files | Git add, document in mcp-code-neural-register.md |
| **Scattered Verify Scripts** | 8+ files | Review against existing health_check.py |
| **Schema Docs** | 4 files | Archive v2 files (LAW: keep single source) |
| **Test Files in Wrong Location** | 3 files | Move to tests/ per project structure |

---

## Revised Recommendations (Per Documentation Standards)

### 1. Install Escape Scripts -> Installation Compendium Issue #5

**Per `docs/debug/README.md`**: New issues go into domain compendiums, not new files.

**Action**: Add **Issue #5: Broken Venv Escape Strategies** to `docs/debug/installation/installation-compendium.md`

The scripts document a real failure pattern (trapped in broken venv) that should be:
1. **Documented** as Issue #5 in the compendium
2. **Archived** to `docs/archive/historical/` with context
3. **Extracted** to LAW #12 in installation-neural-register.md if pattern is significant

**New Law Candidate (LAW #12)**:
> **Statement**: When workspace Python is corrupted, escape via subprocess to system Python with absolute path (`/opt/homebrew/bin/python3.11 -c "..."`)

---

### 2. ELEFANTE_MODE Feature -> MCP Code Neural Register

**Per `docs/debug/README.md`**: New patterns should update the relevant Neural Register.

**Files to git add**:
```bash
git add src/utils/elefante_mode.py
git add docs/debug/debug-snapshot-2025-12-11-elefante-mode.md
```

**Action**: Add to `docs/debug/mcp-code-neural-register.md`:
- New safeguard: ELEFANTE_MODE multi-IDE lock protection
- Reference the debug snapshot as source document

---

### 3. Test Files -> tests/ Directory

**Per project structure**: All test files belong in `tests/`

```bash
mv scripts/test_mcp_live.py tests/
mv scripts/utils/test_semantic_search.py tests/
mv scripts/debug/test_tools.py tests/debug/
```

---

### 4. Schema Documentation -> Archive v2

**Per `docs/README.md` Documentation Etiquette**: "Keep FINAL, archive versions"

**Current state**: 4 schema files
- `memory-schema-v2.md` -> Archive
- `memory-schema-v3.md` -> Keep as canonical
- `v2-schema-simple.md` -> Archive
- `zlctp-memory-schema-v3-handoff.md` -> Archive (planning doc, not technical)

**Action**:
```bash
mv docs/technical/memory-schema-v2.md docs/archive/historical/
mv docs/technical/v2-schema-simple.md docs/archive/historical/
mv docs/planning/zlctp-memory-schema-v3-handoff.md docs/archive/historical/
```

---

### 5. Verify Scripts -> Consolidate into health_check.py

**Per Neural Register documentation**: `health_check.py` is the canonical verification script.

**Current scattered verify scripts**:
- `scripts/verify_clean.py`
- `scripts/verify_injection.py`
- `scripts/verify_install_logged.py`
- `scripts/verify_intelligence.py`
- `scripts/verify_mcp_handshake.py`

**Action**: Review each, merge unique functionality into `scripts/health_check.py`, archive redundant ones.

---

## Install Scripts Archive Structure

**Per `docs/archive/README.md`**: "Session logs, completed task lists" go to `archive/historical/`

```
docs/archive/historical/install-escape-2025-12-11/
├── README.md                    # Context explaining the debugging session
├── AUTONOMOUS_INSTALL.py
├── DIRECT_INSTALL.py
├── DO_INSTALL.py
├── NUCLEAR_INSTALL.py
├── RUN_INSTALL.py
└── autonomous_fix.py
```

**README.md content**:
```markdown
# Install Escape Scripts (2025-12-11)

**Context**: During Dec 11 installation, workspace venv became corrupted.
Standard `scripts/install.py` could not execute because VS Code/agent
was trapped in the broken environment.

**Problem**: Agent running from broken .venv couldn't call system Python
**Solution Progression**: Each script tried different escape strategies

See: docs/debug/installation/installation-compendium.md Issue #5
```

---

## Compliance with Documentation Standards

| Standard | Compliance |
|----------|------------|
| Neural Register format |  Will add LAW #12 to installation-neural-register |
| Compendium issue tracking |  Will add Issue #5 to installation-compendium |
| Archive structure |  Using `archive/historical/` correctly |
| Single source of truth |  Consolidating verify scripts, archiving v2 docs |
| Test file location |  Moving to tests/ |

---

## Action Checklist

```
[ ] 1. Create docs/archive/historical/install-escape-2025-12-11/
[ ] 2. Move 6 install escape scripts to archive with README
[ ] 3. Add Issue #5 to installation-compendium.md
[ ] 4. Extract LAW #12 to installation-neural-register.md
[ ] 5. Git add src/utils/elefante_mode.py
[ ] 6. Update mcp-code-neural-register.md with ELEFANTE_MODE
[ ] 7. Move test files to tests/
[ ] 8. Archive v2 schema docs
[ ] 9. Review verify scripts for consolidation
```

---

**This audit follows the project's established documentation standards.**

##  DOCUMENTED: Install Script Evolution (Dec 11 Session)

### Context: Why Multiple Scripts Exist

During the Dec 11 installation session, the workspace environment became corrupted. The standard `scripts/install.py` could not be executed because:

1. **Broken venv**: The `.venv` was created with wrong Python version or corrupted
2. **Agent trapped in workspace**: VS Code/Copilot was running Python from the broken `.venv`
3. **Circular dependency**: Couldn't fix the environment from within the broken environment

Each script represents a **different escape strategy**:

### Script Progression (Chronological)

| Script | Time | Strategy | Problem It Solved |
|--------|------|----------|-------------------|
| `RUN_INSTALL.py` | 10:37 | Wrapper to call DO_INSTALL via system python | Initial attempt to escape workspace |
| `DO_INSTALL.py` | 10:37 | Minimal script (50 lines) | Reduce complexity, avoid imports |
| `AUTONOMOUS_INSTALL.py` | 10:36 | Full-featured with logging | Track what's happening |
| `NUCLEAR_INSTALL.py` | 10:41 | Embedded script-in-string | Escape via subprocess inception |
| `DIRECT_INSTALL.py` | 10:43 | Shebang `#!/usr/bin/env python3.11` | Force system Python at OS level |
| `scripts/autonomous_fix.py` | - | Production-ready version | Best practices, error handling |

### What Each Script Does Differently

**`RUN_INSTALL.py`** (612 bytes)
- Simple wrapper that calls `DO_INSTALL.py` via `/opt/homebrew/bin/python3.11`
- Used when `python3.11 DO_INSTALL.py` couldn't be typed directly

**`DO_INSTALL.py`** (1249 bytes)
- Minimal, no imports beyond stdlib
- Direct subprocess calls, no error handling
- "Just make it work" approach

**`AUTONOMOUS_INSTALL.py`** (5062 bytes)
- Full logging to `INSTALL_LOG.txt`
- Proper error handling and reporting
- Timeout protection on all commands

**`NUCLEAR_INSTALL.py`** (2676 bytes)
- Embeds the entire install script as a string
- Executes via `python3.11 -c "script"`
- "Break glass" approach when nothing else works

**`DIRECT_INSTALL.py`** (3293 bytes)
- Uses shebang `#!/usr/bin/env python3.11` to force system Python
- Step-by-step with visual separators
- Final successful approach

**`scripts/autonomous_fix.py`** (5107 bytes)
- Production version with proper logging
- Cross-platform support (Windows/macOS/Linux)
- Retry logic for stubborn deletions

### Decision: Keep or Archive?

**Recommendation: ARCHIVE, don't delete**

These scripts document a real debugging session and solution patterns. They should be:
1. Moved to `docs/archive/historical/install-escape-scripts/`
2. Referenced in installation troubleshooting docs
3. Available if the same situation recurs

### Root Cause to Prevent Recurrence

The underlying issue was:
- VS Code workspace Python pointed to broken `.venv`
- No easy way to "escape" to system Python from within IDE
- Agent couldn't run system Python commands directly

**Prevention:** Add to `scripts/install.py`:
- Detection of "trapped in broken venv" scenario
- Auto-escape to system Python if detected

---

##  VIOLATION 2: Scattered Reset/Debug Scripts

### Evidence
```
./scripts/factory_reset.py          - Deletes Chroma + Kuzu
./scripts/debug/nuclear_reset_kuzu.py - Backs up + deletes Kuzu only
./scripts/debug/remove_kuzu_lock.py   - Removes lock file only
./scripts/debug/unlock_database.py    - Another unlock variant
./scripts/debug/repair_chromadb.py    - Repairs Chroma
./scripts/debug/auto_repair_chromadb.py - Auto-repairs Chroma
./scripts/debug/fix_segments_table.py - Fixes specific Chroma issue
```

### Problem (L5.2 Violation)
- Multiple scripts for overlapping "reset" functionality
- No single "recovery toolkit" concept
- User doesn't know which to run

### Canonical Recommendation
Create `scripts/recovery.py` with subcommands:
- `python scripts/recovery.py reset --all`
- `python scripts/recovery.py reset --kuzu`
- `python scripts/recovery.py repair --chroma`
- `python scripts/recovery.py unlock`

---

##  VIOLATION 3: Schema Documentation Fragmentation

### Evidence
```
./docs/technical/memory-schema-v2.md
./docs/technical/memory-schema-v3.md
./docs/technical/v2-schema-simple.md
./docs/planning/zlctp-memory-schema-v3-handoff.md
```

### Problem (L5.2 Violation)
- 4 files about schema with unclear "which is current?"
- `v2-schema-simple.md` appears to be a simplified v2
- `zlctp-memory-schema-v3-handoff.md` is in planning, not technical

### Canonical Location
`docs/technical/memory-schema-v3.md` should be THE schema reference

### Recommendation
1. Archive v2 files: `docs/archive/historical/memory-schema-v2.md`
2. Move handoff to archive after v3 is stable
3. Single source: `docs/technical/memory-schema.md` (drop version suffix when stable)

---

##  VIOLATION 4: Test Files in Wrong Locations

### Evidence
```
./scripts/test_mcp_live.py           - Should be in tests/
./scripts/utils/test_semantic_search.py - Should be in tests/
./scripts/utils/manual_test_memory_persistence.py - Should be in tests/
./scripts/debug/test_tools.py        - Should be in tests/
```

### Problem (L5.1 Violation)
- Test files scattered across scripts/
- `tests/` directory exists but not used consistently

### Canonical Location
All test files should be in `tests/` with proper naming:
- `tests/test_mcp_live.py`
- `tests/test_semantic_search.py`
- `tests/manual/test_memory_persistence.py`

---

##  VIOLATION 5: Verify Scripts Proliferation

### Evidence
```
./scripts/verify_clean.py
./scripts/verify_injection.py
./scripts/verify_install_logged.py
./scripts/verify_intelligence.py
./scripts/verify_mcp_handshake.py
./scripts/utils/verify_memories.py
./scripts/debug/verify_memory_retrieval.py
./tests/verification/verify_m4_compatibility.py
```

### Problem (L5.2 Violation)
- 8 different "verify" scripts
- No unified verification entry point
- Unclear which to run for what purpose

### Recommendation
Create `scripts/verify.py` with subcommands or consolidate into `scripts/health_check.py`

---

##  VIOLATION 6: Untracked Files (Orphans)

### Evidence (24 untracked files)
```
# Experimental install scripts (DELETE)
./AUTONOMOUS_INSTALL.py
./DIRECT_INSTALL.py
./DO_INSTALL.py
./NUCLEAR_INSTALL.py
./RUN_INSTALL.py
./install_daemon.sh
./scripts/autonomous_fix.py
./scripts/emergency_fix.sh
./scripts/force_reinstall.py

# New feature files (KEEP, need git add)
./src/utils/elefante_mode.py
./scripts/test_mcp_live.py
./scripts/verify_injection.py
./scripts/verify_mcp_handshake.py
./docs/debug/debug-snapshot-2025-12-11-elefante-mode.md

# Documentation (REVIEW)
./docs/DOCUMENTATION_GAPS_RESOLVED.md
./docs/technical/dashboard-startup.md
./docs/technical/kuzu-lock-monitoring.md
./docs/technical/mcp-server-startup.md
./docs/technical/python-version-requirements.md

# Other
./.venv_DISABLED
./scripts/debug/list_recent.py
./scripts/factory_reset.py
./scripts/ingest_inception.py
./tests/integration/test_integration_memory_persistence.py
```

### Problem (L5.4 Violation)
- Future agents won't know these exist (not in git)
- Some are experiments, some are legitimate additions
- No clear "what to keep" documentation

---

##  VIOLATION 7: Roadmap/Planning Fragmentation

### Evidence
```
./docs/planning/roadmap.md
./docs/planning/dashboard-improvement-roadmap.md
./docs/planning/sprint2-knowledge-topology-plan.md
./docs/archive/historical/task-roadmap-completed.md
```

### Problem (L5.2 Violation)
- Multiple roadmap files
- Unclear which is authoritative

### Recommendation
- Single `docs/planning/roadmap.md` for all active roadmap items
- Archive completed sprints to `docs/archive/`

---

## Recommended Actions

### Immediate (Before Any New Work)

1. **ARCHIVE (not delete) root install scripts:**
   ```bash
   mkdir -p docs/archive/historical/install-escape-scripts
   mv AUTONOMOUS_INSTALL.py DIRECT_INSTALL.py DO_INSTALL.py NUCLEAR_INSTALL.py RUN_INSTALL.py docs/archive/historical/install-escape-scripts/
   mv install_daemon.sh scripts/autonomous_fix.py scripts/emergency_fix.sh docs/archive/historical/install-escape-scripts/
   # Create README explaining the context
   ```

2. **Git add legitimate new files:**
   ```bash
   git add src/utils/elefante_mode.py
   git add scripts/test_mcp_live.py scripts/verify_injection.py scripts/verify_mcp_handshake.py
   git add scripts/factory_reset.py
   git add docs/debug/debug-snapshot-2025-12-11-elefante-mode.md
   git add docs/debug/law5-audit-2025-12-11.md
   ```

3. **Move misplaced test files:**
   ```bash
   mv scripts/test_mcp_live.py tests/
   mv scripts/utils/test_semantic_search.py tests/
   ```

### Short-Term (Next Sprint)

4. **Consolidate reset/debug scripts** into `scripts/recovery.py`
5. **Consolidate verify scripts** into `scripts/health_check.py` or `scripts/verify.py`
6. **Archive v2 schema docs** to `docs/archive/`

### Documentation Update

7. Add to `scripts/README.md`:
   - Which script to use for what purpose
   - Canonical entry points

---

## Canonical Structure (Target State)

```
/
├── install.sh, install.bat          # Entry points (calls scripts/install.py)
├── README.md, CHANGELOG.md          # Root docs only
├── config.yaml, setup.py            # Config only
│
├── scripts/
│   ├── install.py                   # CANONICAL installer
│   ├── health_check.py              # CANONICAL system check
│   ├── recovery.py                  # CANONICAL reset/repair (TO CREATE)
│   ├── verify.py                    # CANONICAL verification (TO CREATE)
│   └── debug/                       # Low-level debug tools
│
├── tests/
│   ├── test_*.py                    # ALL test files here
│   └── integration/
│
├── docs/
│   ├── technical/
│   │   └── memory-schema.md         # SINGLE schema doc
│   ├── planning/
│   │   └── roadmap.md               # SINGLE roadmap
│   └── archive/                     # Old versions
│
└── src/                             # Production code only
```

---

**This audit preserves evidence. No files were modified or deleted.**
